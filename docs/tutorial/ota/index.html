<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ESP32 Manager Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ESP32 Manager Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4LC1CTFLW8"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4LC1CTFLW8",{})</script><title data-react-helmet="true">OTA updates | ESP32 Manager</title><meta data-react-helmet="true" property="og:url" content="https://esp32m.com/docs/tutorial/ota"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="OTA updates | ESP32 Manager"><meta data-react-helmet="true" name="description" content="OTA (Over-The-Air) feature allows to flash new application using WiFi connection, by downloading the application binary from a remote HTTP server."><meta data-react-helmet="true" property="og:description" content="OTA (Over-The-Air) feature allows to flash new application using WiFi connection, by downloading the application binary from a remote HTTP server."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://esp32m.com/docs/tutorial/ota"><link data-react-helmet="true" rel="alternate" href="https://esp32m.com/docs/tutorial/ota" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://esp32m.com/docs/tutorial/ota" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9a8a25c0.css">
<link rel="preload" href="/assets/js/runtime~main.9b3f5d02.js" as="script">
<link rel="preload" href="/assets/js/main.0ed63a23.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="ESP32 Manager logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="ESP32 Manager logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ESP32 Manager</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/esp32m/core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="ESP32 Manager logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="ESP32 Manager logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ESP32 Manager</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/intro">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/esp32m/core" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/starting">Quick start</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/create-project">Create New Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/building-flashing">Build and Flash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/mqtt">MQTT setup</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/tutorial/ota">OTA updates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/remote-logging">Remote Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/sensor-monitoring">Monitoring sensors</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/project-structure">Project structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/esp32m-py">esp32m.py tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/api">API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/components">Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/devices">Devices</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">OTA updates</h1></header><p>OTA (Over-The-Air) feature allows to flash new application using WiFi connection, by downloading the application binary from a remote HTTP server.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-http-server"></a>Setting up HTTP server<a class="hash-link" href="#setting-up-http-server" title="Direct link to heading">#</a></h2><p>Use any HTTP server of your choice (for example, <a href="//www.nginx.com/" target="_blank" rel="noopener noreferrer">Nginx</a>). The server must allow binary file downloads, and must be accessible to your ESP32 device either by IP or by DNS name. It is advisable to set up TLS encryption (<code>https://</code> protocol), especially if you plan to update application over the Internet, to enforce integrity of your application. One of the easiest way to set up free TLS ceritificate is by using a <a href="//certbot.eff.org/" target="_blank" rel="noopener noreferrer">Certbot</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="uploading-the-application"></a>Uploading the application<a class="hash-link" href="#uploading-the-application" title="Direct link to heading">#</a></h2><p>You can either do that manually by copying the <code>dist/firmware.bin</code> to the download directory of your HTTP server, or configure our <a href="/docs/reference/esp32m-py">esp32m.py tool</a> to automatically copy the application binary after the build process is complete. You just need to specify the path to the download directory in the <code>esp32m.json</code> config file, or using the command line. <a href="/docs/reference/esp32m-py">This page</a> provides details on how to do that. Note that the binary application file in the <code>dist/</code> folder is named after your project name.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-the-client"></a>Setting up the client<a class="hash-link" href="#setting-up-the-client" title="Direct link to heading">#</a></h2><p>OTA module must be included and initialized in your project, like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;esp32m/net/ota.hpp&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>at the start of your <code>main.cpp</code>, and </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">net</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">useOta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>in the <code>void app_main()</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="partition-table-considerations"></a>Partition table considerations<a class="hash-link" href="#partition-table-considerations" title="Direct link to heading">#</a></h2><p>OTA update process is a native ESP-IDF feature explained in detail in <a href="//docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/ota.html" target="_blank" rel="noopener noreferrer">this article</a>. In short, ESP-IDF maintains at least two separate slots of the same size in the partition table (ota_0 and ota_1), of which one is currently running application, and the other one is used to download new application. If the download process was successful and all integrity checks were OK, the second partitition becomes active, and the first one will accept the
application binary on the next update, and so on. This approach allows to survive incomplete or broken updates, but requires twice as much flash memory. Therefore, only a little less than 2MB of flash remains available for the application. If you want to use OTA with a bigger application, or need flash space for other purposes, consider ESP32 module with 8MB or 16MB flash chip.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="updating-the-application"></a>Updating the application<a class="hash-link" href="#updating-the-application" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="from-the-user-interface"></a>From the User Interface<a class="hash-link" href="#from-the-user-interface" title="Direct link to heading">#</a></h3><p>Click on the <code>System</code> link in the sidebar menu and enter the application URL in the <code>Administration</code> box, then click Update:</p><p><img alt="administration" src="/assets/images/administration-71cf5ba4cd58098f0f6383bbe76f24b1.png"></p><p>If the progress bar appears in a few seconds - the update process has started, and must not be interrupted until finished. You will not be able to use the device during the update process. When the update is finished, the MCU will reboot automatically and should become accessible again witin a few seconds. If the progress bar doesn&#x27;t appear for a long time (over 20 seconds), it usually means that the MCU cannot download the application binary for some reason. Check the URL, make sure that you can download application from a browser and check if your firewall blocks the MCU. You can also set up <a href="/docs/tutorial/remote-logging">Remote logging</a> to check for extended error/warning messages.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-the-websockets-api"></a>Using the WebSockets API<a class="hash-link" href="#using-the-websockets-api" title="Direct link to heading">#</a></h3><p>Establish WebSocktets connection with your ESP32 and send this message to start application update:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;request&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;target&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ota&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;update&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;data&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;url&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://my-server.net/firmware/my-firmware.bin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="/docs/reference/api#websockets">See details</a> on WebSockets API</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-the-mqtt-api"></a>Using the MQTT API<a class="hash-link" href="#using-the-mqtt-api" title="Direct link to heading">#</a></h3><p>Send the message </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;url&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://my-server.net/firmware/my-firmware.bin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to the target <code>esp32m/request/project_name/ota/update</code> (replace <code>project_name</code> with the name of your project)</p><p><a href="/docs/reference/api#mqtt">See details</a> on MQTT API</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/esp32m/website/edit/master/website/docs/tutorial/ota.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorial/mqtt"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« MQTT setup</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tutorial/remote-logging"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Remote Logging Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-http-server" class="table-of-contents__link">Setting up HTTP server</a></li><li><a href="#uploading-the-application" class="table-of-contents__link">Uploading the application</a></li><li><a href="#setting-up-the-client" class="table-of-contents__link">Setting up the client</a></li><li><a href="#partition-table-considerations" class="table-of-contents__link">Partition table considerations</a></li><li><a href="#updating-the-application" class="table-of-contents__link">Updating the application</a><ul><li><a href="#from-the-user-interface" class="table-of-contents__link">From the User Interface</a></li><li><a href="#using-the-websockets-api" class="table-of-contents__link">Using the WebSockets API</a></li><li><a href="#using-the-mqtt-api" class="table-of-contents__link">Using the MQTT API</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/project-structure">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/esp32m/core" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHib<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/esp32m" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9b3f5d02.js"></script>
<script src="/assets/js/main.0ed63a23.js"></script>
</body>
</html>