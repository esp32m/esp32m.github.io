"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1802],{243:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>a});var n=s(5893),i=s(1151);const o={sidebar_position:3},r="MQTT setup",l={id:"tutorial/mqtt",title:"MQTT setup",description:"MQTT is a lightweight and simple publish-subscribe messaging protocol, ideal for IOT devices. esp32m makes use of MQTT for many purposes, such as:",source:"@site/docs/tutorial/mqtt.md",sourceDirName:"tutorial",slug:"/tutorial/mqtt",permalink:"/docs/tutorial/mqtt",draft:!1,unlisted:!1,editUrl:"https://github.com/esp32m/website/edit/master/website/docs/tutorial/mqtt.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Build and Flash",permalink:"/docs/tutorial/building-flashing"},next:{title:"OTA updates",permalink:"/docs/tutorial/ota"}},c={},a=[{value:"Server setup",id:"server-setup",level:3},{value:"Client setup",id:"client-setup",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"mqtt-setup",children:"MQTT setup"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"//mqtt.org/",children:"MQTT"})," is a lightweight and simple publish-subscribe messaging protocol, ideal for IOT devices. ",(0,n.jsx)(t.code,{children:"esp32m"})," makes use of MQTT for many purposes, such as:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"feeding sensor readings into external time-series databases;"}),"\n",(0,n.jsx)(t.li,{children:"remote logging;"}),"\n",(0,n.jsxs)(t.li,{children:["controlling ESP32 remotely via ",(0,n.jsx)(t.a,{href:"/docs/reference/api#mqtt",children:"MQTT API"}),".\r\nThe size of MQTT client in the compiled binary is pretty small (about 50KB), so it is a good idea to include it in your application."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"server-setup",children:"Server setup"}),"\n",(0,n.jsxs)(t.p,{children:["We use ",(0,n.jsx)(t.a,{href:"//mosquitto.org/",children:"Mosquitto server"}),", but it is possible to use any other that follows ",(0,n.jsx)(t.a,{href:"//mqtt.org/",children:"MQTT protocol"}),". Mosquitto requires zero configuration and works with ",(0,n.jsx)(t.code,{children:"esp32m"})," out-of-the-box."]}),"\n",(0,n.jsx)(t.h3,{id:"client-setup",children:"Client setup"}),"\n",(0,n.jsxs)(t.p,{children:["Add the following code to your ",(0,n.jsx)(t.code,{children:"main.cpp"})," to enable MQTT API:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-cpp",children:"#include <esp32m/net/mqtt.hpp>\r\n\r\n...\r\n\r\nnet::useMqtt();\r\n\r\n// If you also want to enable UI for MQTT\r\nnew Ui(&ui::Mqtt::instance());\n"})}),"\n",(0,n.jsx)(t.p,{children:"In the UI:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import { startUi, Mqtt } from "esp32m/ui";\r\n\r\nstartUi({ plugins: [Mqtt] });\n'})}),"\n",(0,n.jsxs)(t.p,{children:["By default, MQTT client module looks for ",(0,n.jsx)(t.code,{children:"mqtt.lan"})," name on your local network. You can just add this name to the ",(0,n.jsx)(t.code,{children:"/etc/hosts"})," file on the machine with the MQTT server, or add static name to your local DNS. Alternatively, you can pass URL of your MQTT server to the ",(0,n.jsx)(t.code,{children:"net::useMqtt();"})," command, it would be something like ",(0,n.jsx)(t.code,{children:"mqtt://192.168.0.10"}),". Another option is to configure MQTT client from within the ",(0,n.jsx)(t.code,{children:"esp32m UI"}),": click on the ",(0,n.jsx)(t.code,{children:"MQTT Client"})," link in the sidebar menu, enter the details and click Save button:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"mqtt-settings",src:s(8747).Z+"",width:"567",height:"326"})}),"\n",(0,n.jsx)(t.p,{children:"if the connection succeeds, you should see the following box in a couple of seconds:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"mqtt-settings",src:s(5285).Z+"",width:"574",height:"331"})})]})}function u(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8747:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/mqtt-settings-725c9cf0332af32572948ee5163120e2.png"},5285:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/mqtt-state-d50f46cce5d5ba8afa721f50f53bd0d6.png"},1151:(e,t,s)=>{s.d(t,{Z:()=>l,a:()=>r});var n=s(7294);const i={},o=n.createContext(i);function r(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);