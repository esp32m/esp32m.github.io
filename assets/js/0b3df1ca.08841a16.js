"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7093],{9913:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var t=n(5893),r=n(1151);const i={sidebar_position:5},o="Monitoring sensors",a={id:"tutorial/sensor-monitoring",title:"Monitoring sensors",description:"esp32m allows to monitor sensors in real time, and also perform historical analysis by feeding sensor readings into time-series database.",source:"@site/docs/tutorial/sensor-monitoring.md",sourceDirName:"tutorial",slug:"/tutorial/sensor-monitoring",permalink:"/docs/tutorial/sensor-monitoring",draft:!1,unlisted:!1,editUrl:"https://github.com/esp32m/website/edit/master/website/docs/tutorial/sensor-monitoring.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Remote Logging",permalink:"/docs/tutorial/remote-logging"},next:{title:"Project structure",permalink:"/docs/reference/project-structure"}},l={},c=[{value:"Real-time monitoring",id:"real-time-monitoring",level:2},{value:"From the UI",id:"from-the-ui",level:3},{value:"Using the API",id:"using-the-api",level:3},{value:"MQTT",id:"mqtt",level:4},{value:"WebSockets",id:"websockets",level:4},{value:"Historical analysis",id:"historical-analysis",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"monitoring-sensors",children:"Monitoring sensors"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"esp32m"})," allows to monitor sensors in real time, and also perform historical analysis by feeding sensor readings into time-series database."]}),"\n",(0,t.jsx)(s.h2,{id:"real-time-monitoring",children:"Real-time monitoring"}),"\n",(0,t.jsx)(s.h3,{id:"from-the-ui",children:"From the UI"}),"\n",(0,t.jsx)(s.p,{children:"Every supported sensor has a corresponding UI module that is available from the Devices menu in the UI. UI widgets request state updates from the backend approximately every second, and you can observe changes on the Web page in real time, for example:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"bme280",src:n(1003).Z+"",width:"567",height:"326"})}),"\n",(0,t.jsx)(s.h3,{id:"using-the-api",children:"Using the API"}),"\n",(0,t.jsx)(s.h4,{id:"mqtt",children:"MQTT"}),"\n",(0,t.jsxs)(s.p,{children:["First, refer to ",(0,t.jsx)(s.a,{href:"/docs/tutorial/mqtt",children:"MQTT setup"})," tutorial page to enable MQTT data feed. Once MQTT connection is established, ",(0,t.jsx)(s.code,{children:"esp32m"})," will start to send sensor readings over MQTT protocol automatically for every connected and configured sensor, approximately every second, in the ",(0,t.jsx)(s.strong,{children:"influxdb"})," format, for example:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"topic"}),": esp32m/sensor/basic"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"message"}),": esp32m,unit=basic,device=BME280 temperature=33.64"]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"websockets",children:"WebSockets"}),"\n",(0,t.jsxs)(s.p,{children:["Refer to ",(0,t.jsx)(s.a,{href:"/docs/reference/api#websockets",children:"WebSockets API reference"})," for general guidelines. Getting sensor readings via WebSockets is as easy as issuing a ",(0,t.jsx)(s.code,{children:"state-get"})," request, for example:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{"type":"request","target":"BME280","name":"state-get"}\n'})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"esp32m"})," responds:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{"type":"response","source":"BME280","name":"state-get","data":{"addr":118,"temperature":33.64,"pressure":98758.39,"humidity":33.65}}\n'})}),"\n",(0,t.jsx)(s.h2,{id:"historical-analysis",children:"Historical analysis"}),"\n",(0,t.jsxs)(s.p,{children:["There are many different tools to store and analyze time-series data that may work with ",(0,t.jsx)(s.code,{children:"esp32m"}),". In this example we will use ",(0,t.jsx)(s.strong,{children:"Influxdb"})," with ",(0,t.jsx)(s.strong,{children:"Chronograph"})," on a ",(0,t.jsx)(s.strong,{children:"Debian Stretch"})," Linux."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Install ",(0,t.jsxs)(s.a,{href:"//mosquitto.org",children:[(0,t.jsx)(s.em,{children:"Mosquitto"})," server"]}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Configure MQTT connection on your ESP32, use ",(0,t.jsx)(s.a,{href:"/docs/tutorial/mqtt",children:"this guide"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Install ",(0,t.jsxs)(s.a,{href:"//www.influxdata.com/",children:[(0,t.jsx)(s.strong,{children:"Influxdb"}),", ",(0,t.jsx)(s.strong,{children:"Telegraf"})," and ",(0,t.jsx)(s.strong,{children:"Chronograph"})]}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Configure ",(0,t.jsx)(s.strong,{children:"Telegraf"})," to subscribe for MQTT messages and feed them into ",(0,t.jsx)(s.strong,{children:"Influxdb"}),", in /etc/telegraf.conf"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Finally, you should see something like this in your browser:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"chronograf",src:n(7338).Z+"",width:"1701",height:"1179"})})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1003:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/bme280-be67a96dcc9745efd57458cf9cf370a8.png"},7338:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/chronograf-74f50ac6e159970039e7c6539bd41da8.png"},1151:(e,s,n)=>{n.d(s,{Z:()=>a,a:()=>o});var t=n(7294);const r={},i=t.createContext(r);function o(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);